# Руководство пользователя "Smart Home Control"

## 1. Введение

Добро пожаловать в "Smart Home Control"! Это приложение поможет вам легко управлять релейными модулями на базе ESP8266 в вашем умном доме. Вы сможете добавлять устройства, контролировать состояние каждого реле, а также создавать и запускать автоматические сценарии для управления несколькими устройствами одновременно.

## 2. Установка и первая настройка

### 2.1. Установка приложения
*   **Android:** Установите APK-файл приложения на ваше Android-устройство.


### 2.2. Первый запуск
При первом запуске приложения вы увидите главный экран. В нижней части экрана находится панель навигации с двумя вкладками:
*   **Устройства:** Для управления отдельными релейными модулями.
*   **Сценарии:** Для создания и запуска последовательностей команд для ваших устройств.

### 2.3. Настройка ESP8266
Перед использованием приложения убедитесь, что:
1.  Ваши ESP8266-устройства прошиты соответствующей прошивкой (`esp8266_relay_controller.ino`).
2.  Устройства подключены к той же Wi-Fi сети, что и ваш смартфон.
3.  Вы знаете IP-адреса ваших ESP8266-устройств. Их можно посмотреть на OLED-дисплее устройства (если он есть) или в списке подключенных клиентов вашего Wi-Fi роутера.

## 3. Работа с устройствами

### 3.1. Переход на вкладку "Устройства"
Нажмите на иконку "Устройства" (обычно изображение нескольких гаджетов) на нижней панели навигации.

### 3.2. Добавление нового устройства
Нажмите на плавающую кнопку "+" (Добавить) в правом нижнем углу экрана. Откроется экран "Добавить устройство".

*   **Автоматический поиск:**
    1.  Нажмите кнопку "Начать поиск" в разделе "Автоматический поиск".
    2.  Приложение просканирует вашу локальную сеть на наличие совместимых устройств.
    3.  Найденные устройства будут автоматически добавлены в список на главном экране, и вы вернетесь на него.
    4.  Если устройства не найдены, убедитесь, что они включены и подключены к той же Wi-Fi сети.

*   **Ручное добавление:**
    1.  В разделе "Ручное добавление" введите IP-адрес вашего ESP8266-устройства в поле "IP-адрес" (например, `192.168.1.100`).
    2.  Вы можете нажать иконку "Проверить соединение" (сетевая вилка) для проверки доступности устройства. Результат проверки отобразится под полем ввода.
    3.  Нажмите кнопку "Добавить устройство".
    4.  Если устройство доступно и совместимо, оно будет добавлено в список, и вы вернетесь на главный экран. В случае ошибки появится соответствующее сообщение.

### 3.3. Просмотр списка устройств
На вкладке "Устройства" вы увидите список всех добавленных релейных модулей. Каждое устройство отображается в виде карточки, содержащей:
*   Имя устройства (по умолчанию "SmartRelay").
*   IP-адрес устройства.
*   Уровень сигнала Wi-Fi (RSSI).
*   Количество активных реле из общего числа.
*   Список реле с их именами и текущим состоянием (ВКЛ/ВЫКЛ).

### 3.4. Управление реле
В карточке каждого устройства для каждого реле доступны:
*   **Индикатор состояния:** Кружок слева от имени реле (зеленый - ВКЛ, серый - ВЫКЛ).
*   **Имя реле.**
*   **Кнопка переключения состояния:** "Включить" или "Выключить". Нажмите ее, чтобы изменить состояние реле.

### 3.5. Переименование реле
1.  В карточке устройства найдите нужное реле.
2.  Нажмите на иконку карандаша (Редактировать) справа от имени реле.
3.  Во всплывающем окне введите новое имя для реле.
4.  Нажмите "Сохранить". Новое имя будет отправлено на устройство и сохранено в его памяти.

### 3.6. Обновление статуса устройства
*   **Обновить все устройства:** Нажмите иконку "Обновить" (круговая стрелка) в правом верхнем углу AppBar на вкладке "Устройства".
*   **Обновить одно устройство:**
    1.  В карточке нужного устройства нажмите на иконку с тремя точками (Меню).
    2.  Выберите "Обновить".

### 3.7. Удаление устройства
1.  В карточке нужного устройства нажмите на иконку с тремя точками (Меню).
2.  Выберите "Удалить".
3.  Подтвердите удаление во всплывающем диалоге.

## 4. Работа со сценариями

Сценарии позволяют автоматизировать управление вашими устройствами, выполняя последовательность действий.

### 4.1. Переход на вкладку "Сценарии"
Нажмите на иконку "Сценарии" (обычно изображение волшебной палочки или звезд) на нижней панели навигации.

### 4.2. Создание нового сценария
1.  Нажмите на плавающую кнопку "+" (Создать) в правом нижнем углу экрана. Откроется экран "Создание сценария" (или "Редактирование сценария").
2.  **Основная информация:**
    *   **Название сценария:** Введите понятное имя для вашего сценария (обязательно).
    *   **Описание:** Добавьте краткое описание того, что делает сценарий (необязательно).
    *   **Цвет сценария:** Нажмите на цветной прямоугольник, чтобы выбрать цвет для визуального выделения сценария.
    *   **Иконка сценария:** Нажмите на иконку, чтобы выбрать подходящий значок для сценария.
    *   **Активен:** Переключатель, определяющий, можно ли запускать этот сценарий. По умолчанию включен.
3.  **Действия:**
    *   Нажмите кнопку "Добавить" в разделе "Действия".
    *   Во всплывающем диалоге "Добавление действия":
        *   **Устройство:** Выберите из списка устройство, которым хотите управлять.
        *   **Реле:** Выберите конкретное реле на выбранном устройстве.
        *   **Действие:** Выберите "Включить" или "Выключить".
        *   **Задержка:** С помощью ползунка установите задержку (в секундах или минутах) *перед* выполнением этого действия, если это не первое действие. Для первого действия задержка обычно не нужна.
        *   Нажмите "Добавить".
    *   Добавьте столько действий, сколько необходимо для вашего сценария. Каждое добавленное действие появится в виде карточки.
4.  **Управление действиями в сценарии:**
    *   **Редактировать действие:** Нажмите иконку карандаша на карточке действия.
    *   **Удалить действие:** Нажмите иконку корзины на карточке действия.
    *   **Активировать/деактивировать действие:** Используйте переключатель на карточке действия. Неактивные действия будут пропущены при выполнении сценария.
5.  **Сохранение сценария:**
    *   После настройки всех параметров и добавления действий, нажмите кнопку "Сохранить сценарий" внизу экрана или иконку "Сохранить" в правом верхнем углу AppBar.

### 4.3. Просмотр списка сценариев
На вкладке "Сценарии" вы увидите список всех созданных сценариев. Каждый сценарий отображается в виде карточки, содержащей:
*   Иконку и цвет сценария.
*   Название и описание.
*   Статус (Активен/Отключен).
*   Количество действий и время последнего запуска.

### 4.4. Редактирование существующего сценария
1.  В карточке нужного сценария нажмите кнопку "Изменить".
2.  Откроется экран редактирования, аналогичный экрану создания сценария, где вы можете изменить любые параметры.
3.  Не забудьте сохранить изменения.

### 4.5. Запуск сценария
1.  Убедитесь, что сценарий активен (переключатель в карточке сценария должен быть включен).
2.  В карточке нужного сценария нажмите кнопку "Запустить".
3.  Приложение начнет выполнение действий сценария. Появится уведомление о ходе выполнения.

### 4.6. Просмотр лога выполнения сценария
После запуска сценария (или если возникла ошибка):
1.  В уведомлении о результате выполнения (снизу экрана) может появиться кнопка "Подробнее". Нажмите ее.
2.  Откроется экран "Отчет о выполнении", где будет показан детальный лог каждого шага выполнения сценария, включая ошибки, если они были.
3.  Нажмите "Закрыть" для возврата.

### 4.7. Активация/деактивация сценария
Используйте переключатель в карточке сценария для его включения или выключения. Отключенные сценарии нельзя запустить.

### 4.8. Удаление сценария
1.  В карточке нужного сценария нажмите на иконку корзины (Удалить).
2.  Подтвердите удаление во всплывающем диалоге.

## 5. Устранение неполадок (FAQ)

*   **Устройство не находится при автоматическом поиске:**
    *   Убедитесь, что ESP8266-устройство включено и подключено к той же Wi-Fi сети, что и ваш смартфон.
    *   Проверьте, что mDNS (Bonjour, Avahi) разрешен в вашей сети и на роутере.
    *   Попробуйте добавить устройство вручную по IP-адресу.
    *   Перезагрузите ESP8266-устройство и Wi-Fi роутер.

*   **Ошибка при управлении реле или запуске сценария:**
    *   Проверьте IP-адрес устройства и его доступность в сети.
    *   Убедитесь, что устройство подключено к Wi-Fi. Уровень сигнала можно посмотреть в карточке устройства.
    *   Проверьте лог выполнения сценария для получения подробной информации об ошибке.

*   **Некорректно отображаются имена реле (например, "Ð Реле 1" или "_"):**
    *   Это может быть связано с проблемами кодировки при первоначальной настройке имен на устройстве ESP8266 или при чтении из EEPROM.
    *   Попробуйте переименовать реле через приложение. Это должно исправить имя на устройстве и в приложении.
    *   Если проблема сохраняется, возможно, потребуется проверить прошивку ESP8266 на корректную работу с UTF-8 и EEPROM.

## 6. Заключение

Надеемся, это руководство поможет вам освоить все функции приложения "Smart Home Control". Управляйте своим умным домом с легкостью и создавайте полезные сценарии автоматизации!
